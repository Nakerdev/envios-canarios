#Builder
FROM mcr.microsoft.com/dotnet/core/sdk:3.0 AS builder

COPY . /Project

RUN dotnet restore ./Project/WebApp/backend/Api/Api.csproj
RUN dotnet restore ./Project/Backoffice/backend/Api/Api.csproj

RUN dotnet build ./Project/WebApp/backend/Api/Api.csproj -c Debug -o ./build
RUN dotnet build ./Project/Backoffice/backend/Api/Api.csproj -c Debug -o ./build

RUN dotnet publish ./Project/WebApp/backend/Api/Api.csproj --no-build -c Debug -o ./publish
RUN dotnet publish ./Project/Backoffice/backend/Api/Api.csproj --no-build -c Debug -o ./publish

#Server
FROM mcr.microsoft.com/dotnet/core/aspnet:3.0 as server

COPY --from=builder /publish .

CMD ["dotnet", "CanaryDeliveries.WebApp.Api.dll"]
CMD ["dotnet", "CanaryDeliveries.Backoffice.Api.dll"]
